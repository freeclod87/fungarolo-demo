<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nuovo Permesso - Periodo</title>
  <link rel="stylesheet" href="style.css">
</head>

<body class="rivenditori">
  <nav class="navbar">
    <div class="logo">Portale Rivenditori</div>
    <ul>
      <li><a href="rivenditori-home.html">Home</a></li>
    </ul>
  </nav>

  <main class="container">
    <h1>Definisci il Periodo di Validità</h1>
    <form class="form" action="nuovo-permesso-cf.html" method="get" id="permessoForm">
      <label for="inizio">Data Inizio</label>
      <input type="date" id="inizio" name="inizio" required>

      <label for="tipo">Tipo di Permesso</label>
      <select id="tipo" name="tipo" required>
        <option value="">-- Seleziona un tipo --</option>
        <option value="giornaliero">Giornaliero</option>
        <option value="settimanale">Settimanale</option>
        <option value="mensile">Mensile</option>
        <option value="stagionale">Stagionale</option>
      </select>

      <div id="preview"></div>

      <button type="submit" class="btn" id="submitBtn">Avanti</button>
    </form>
  </main>

  <script>
    const oggi = new Date().toISOString().split('T')[0];
    const inizioInput = document.getElementById('inizio');
    const tipoSelect = document.getElementById('tipo');
    const previewDiv = document.getElementById('preview');
    const submitBtn = document.getElementById('submitBtn');

    inizioInput.value = oggi;
    inizioInput.min = oggi;

    const giorniSettimana = ["Domenica", "Lunedì", "Martedì", "Mercoledì", "Giovedì", "Venerdì", "Sabato"];

    function chiPuoRaccogliere(dayIndex) {
      switch (dayIndex) {
        case 0: return { testo: "Tutti", classe: "stato-tutti" };
        case 1: return { testo: "Solo Residenti", classe: "stato-residenti" };
        case 2: return { testo: "Tutti", classe: "stato-tutti" };
        case 3: return { testo: "Nessuno", classe: "stato-nessuno" };
        case 4: return { testo: "Nessuno", classe: "stato-nessuno" };
        case 5: return { testo: "Tutti", classe: "stato-tutti" };
        case 6: return { testo: "Solo Residenti", classe: "stato-residenti" };
      }
    }

    function calcolaGiorni(tipo) {
      switch (tipo) {
        case "giornaliero": return 1;
        case "settimanale": return 7;
        case "mensile": return 30;
        case "stagionale": return 90;
        default: return 0;
      }
    }

    function aggiornaTabella() {
      const dataInizio = inizioInput.value;
      const tipo = tipoSelect.value;
      previewDiv.innerHTML = "";
      submitBtn.disabled = false;
      submitBtn.classList.remove("disabled");

      if (dataInizio && tipo) {
        const giorni = calcolaGiorni(tipo);
        const startDate = new Date(dataInizio);
        let tableHTML = `
          <table class="table-preview">
            <tr>
              <th>Data</th>
              <th>Chi può raccogliere</th>
            </tr>
        `;

        let tuttiVietati = true;

        for (let i = 0; i < giorni; i++) {
          const current = new Date(startDate);
          current.setDate(startDate.getDate() + i);

          const giornoSettimana = giorniSettimana[current.getDay()];
          const dataStr = current.toLocaleDateString("it-IT");
          const { testo, classe } = chiPuoRaccogliere(current.getDay());

          if (testo !== "Nessuno") {
            tuttiVietati = false;
          }

          tableHTML += `
            <tr>
              <td>${giornoSettimana} ${dataStr}</td>
              <td class="${classe}">${testo}</td>
            </tr>
          `;
        }

        tableHTML += `</table>`;
        previewDiv.innerHTML = tableHTML;

        if (tuttiVietati) {
          submitBtn.disabled = true;
          submitBtn.classList.add("disabled");
        }
      }
    }

    inizioInput.addEventListener("change", aggiornaTabella);
    tipoSelect.addEventListener("change", aggiornaTabella);

    // inizializza tabella
    aggiornaTabella();
  </script>
</body>

</html>